<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Eth-Infinity-Playground â€” WalletConnect (Web3)</title>
<style>
  :root{--bg1:#0b1730;--bg2:#0ea5e9;--card:rgba(255,255,255,0.04)}
  body{margin:0;font-family:Inter,Arial,sans-serif;background:linear-gradient(135deg,var(--bg1),#082032);color:#e6f7ff}
  header{padding:18px;text-align:center}
  .lead{opacity:.9;margin-top:6px}
  .top{display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap}
  .btn{background:#06b6d4;border:none;padding:10px 14px;border-radius:10px;color:#042;cursor:pointer;font-weight:700}
  .addr{font-family:monospace;background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px}
  main{max-width:1200px;margin:20px auto;padding:0 12px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px}
  .card{background:var(--card);padding:14px;border-radius:12px}
  input,textarea{width:100%;padding:8px;border-radius:8px;border:none;margin-top:6px;box-sizing:border-box}
  .callBtn{background:#fb923c;border:none;padding:8px 10px;border-radius:8px;color:#fff;cursor:pointer;margin-top:8px}
  .status{margin-top:8px;font-size:13px;color:#bfffcf;min-height:18px}
  footer{padding:18px;text-align:center;opacity:0.9}
  a.link{color:#ffd;text-decoration:none;font-size:13px}
</style>
</head>
<body>

<header>
  <h1>ðŸŒŒ Eth-Infinity-Playground</h1>
  <div class="lead">WalletConnect + MetaMask (Web3). Click Connect â†’ then use cards to call on-chain functions.</div>
  <div class="top" style="margin-top:10px">
    <button id="btnConnect" class="btn">ðŸ”— Connect Wallet</button>
    <div id="addr" class="addr">Not connected</div>
    <div id="chain" class="addr" style="display:none"></div>
  </div>
</header>

<main>
  <div id="grid" class="grid"></div>
  <div style="font-size:13px;margin-top:12px;opacity:0.9">If a call fails because the ABI differs, open the contract's BaseScan Write page.</div>
</main>

<footer>
  Repo: <code>Eth-infinity-playground</code> â€” Live: <a class="link" href="https://ordiha.github.io/Eth-infinity-playground/" target="_blank">/Eth-infinity-playground/</a>
</footer>

<!-- libs (UMD) -->
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>

<script>
const LEGACY_INFURA_ID = "5056a2b581e5962f9e3083d68053b5d8";
let web3, provider, accounts;

/* ==== New Contracts ==== */
const fallbackContracts = [
  { name:"TipJar", addr:"0x3A683D04B4ebA7a123699b0De74B0f1cF7c909Be", funcs:[{name:"tip",inputs:[],type:"tx",payable:true}] },
  { name:"Faucet", addr:"0xa9749370eeE8b8a07ea6B9dEE9613465706322aF", funcs:[{name:"requestTokens",inputs:[],type:"tx"}] },
  { name:"Raffle", addr:"0x2fc19C9cD545EF178B30A41D17516382133E6f88", funcs:[{name:"buyTicket",inputs:[],type:"tx",payable:true},{name:"drawWinner",inputs:[],type:"tx"}] },
  { name:"DeadMansSwitch", addr:"0x34696e5CfC8D02376fF68CA2cDD55Fcb7ac8062A", funcs:[{name:"ping",inputs:[],type:"tx"},{name:"claim",inputs:[],type:"tx"}] },
  { name:"MultiSig", addr:"0xE2Da7787FA45E95f2A8B5aF907Df2601d73cC865", funcs:[{name:"submitTransaction",inputs:[{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"data",type:"bytes"}],type:"tx"}] },
  { name:"Staking", addr:"0x44976C5BEFf3974d5cbF76eFb523B6EE028bbDA0", funcs:[{name:"stake",inputs:[],type:"tx",payable:true},{name:"withdraw",inputs:[{name:"amt",type:"uint256"}],type:"tx"}] },
  { name:"Vault", addr:"0xE8C08F76961A7c32B27515FfcBb1b2f631BE6B3c", funcs:[{name:"deposit",inputs:[],type:"tx",payable:true},{name:"withdraw",inputs:[{name:"amt",type:"uint256"}],type:"tx"}] },
  { name:"Auction", addr:"0x449311E71bC911e30aE528d54AD379f91c0D7b16", funcs:[{name:"placeBid",inputs:[],type:"tx",payable:true},{name:"endAuction",inputs:[],type:"tx"}] },
  { name:"Splitter", addr:"0xA9849750d46702Dfb44599e1D6a8747D7E67deAE", funcs:[{name:"splitFunds",inputs:[{name:"recipients",type:"address[]"}],type:"tx",payable:true}] },
  { name:"SimpleDEX", addr:"0xD9B49a740C9B43c58da671183d268625Cc88997A", funcs:[{name:"buy",inputs:[{name:"token",type:"address"}],type:"tx",payable:true},{name:"sell",inputs:[{name:"token",type:"address"},{name:"amt",type:"uint256"}],type:"tx"}] },
  { name:"TimelockVault", addr:"0xF8EaA1664406Ae596cFc3559FeF58c9760e0Ed35", funcs:[{name:"deposit",inputs:[],type:"tx",payable:true},{name:"withdraw",inputs:[],type:"tx"}] },
  { name:"BatchSender", addr:"0x07b780Fab0CaDC91c3B788C120F3A3374bCCA431", funcs:[{name:"batchSend",inputs:[{name:"recipients",type:"address[]"}],type:"tx",payable:true}] }
];

/* ===== UI rendering ===== */
function buildUI() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  fallbackContracts.forEach(c => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<h3>${c.name}</h3><div style="font-size:13px;opacity:.9">${c.addr}</div><div id="controls-${c.name}"></div><div class="status" id="status-${c.name}"></div>
      <a class="link" href="https://basescan.org/address/${c.addr}#code" target="_blank">View on BaseScan</a>`;
    grid.appendChild(card);
    const controls = document.getElementById(`controls-${c.name}`);
    (c.funcs||[]).forEach(fn=>{
      const block = document.createElement("div");
      block.style.marginTop = "8px";
      (fn.inputs||[]).forEach(inp=>{
        const inpEl = document.createElement("input");
        inpEl.placeholder = inp.type.includes("address[]") ? `${inp.name} (comma addresses)` :
                             inp.type.includes("address") ? `${inp.name} (address)` :
                             inp.type.includes("uint") ? `${inp.name} (number)` :
                             `${inp.name} (${inp.type})`;
        inpEl.id = `${c.name}_${fn.name}_${inp.name}`;
        inpEl.type = inp.type.includes("uint") ? "number" : "text";
        block.appendChild(inpEl);
      });
      if (fn.payable) {
        const amt = document.createElement("input");
        amt.placeholder = "ETH amount (e.g. 0.001)";
        amt.id = `${c.name}_${fn.name}_value`;
        amt.type = "number"; amt.step="0.000000001";
        block.appendChild(amt);
      }
      const btn = document.createElement("button");
      btn.className = "callBtn";
      btn.innerText = fn.type==="call" ? `Call ${fn.name}` : `Send ${fn.name}`;
      btn.onclick = ()=>invoke(c,fn);
      block.appendChild(btn);
      controls.appendChild(block);
    });
  });
}

/* ===== Connect handling ===== */
async function connect() {
  try {
    if (window.ethereum) {
      provider = window.ethereum;
      await provider.request({ method: "eth_requestAccounts" });
      web3 = new Web3(provider);
      accounts = await web3.eth.getAccounts();
      setConnected(accounts[0]); return;
    }
    const WalletConnectProvider = window.WalletConnectProvider.default;
    provider = new WalletConnectProvider({ infuraId: LEGACY_INFURA_ID });
    await provider.enable();
    web3 = new Web3(provider);
    accounts = await web3.eth.getAccounts();
    setConnected(accounts[0]);
  } catch (err) {
    alert("Connect failed: " + (err.message||err));
  }
}
function setConnected(addr) {
  document.getElementById("addr").innerText = addr || "Unknown";
  document.getElementById("chain").style.display = "inline-block";
  document.getElementById("chain").innerText = "Connected";
}
document.getElementById("btnConnect").onclick = connect;

/* ===== invoke contract functions ===== */
async function invoke(contractObj, fn) {
  const statusEl = document.getElementById(`status-${contractObj.name}`);
  statusEl.innerText = "Processing...";
  try {
    if (!web3) return alert("Connect wallet first!");
    const abi = [{
      name: fn.name,
      type: "function",
      inputs: (fn.inputs||[]).map(i=>({name:i.name,type:i.type})),
      stateMutability: fn.payable ? "payable" : (fn.type==="call" ? "view" : "nonpayable"),
      outputs: fn.type==="call" ? [{type:"string"}] : []
    }];
    const contract = new web3.eth.Contract(abi, contractObj.addr);
    const args = (fn.inputs||[]).map(i=>{
      const el = document.getElementById(`${contractObj.name}_${fn.name}_${i.name}`);
      let v = el? el.value : "";
      if (i.type.endsWith("[]")) return v? v.split(",").map(s=>s.trim()):[];
      if (i.type.startsWith("uint")) return v? v.toString():"0";
      return v;
    });
    const from = (accounts&&accounts[0])||(await web3.eth.getAccounts())[0];
    if (fn.type==="call") {
      const res = await contract.methods[fn.name](...args).call({from});
      statusEl.innerText = `Result: ${JSON.stringify(res)}`;
    } else {
      const valueEl=document.getElementById(`${contractObj.name}_${fn.name}_value`);
      const value=valueEl&&valueEl.value?web3.utils.toWei(valueEl.value.toString(),"ether"):"0";
      const tx=await contract.methods[fn.name](...args).send({from,value});
      statusEl.innerText=`Tx: ${tx.transactionHash}`;
    }
  } catch(err) {
    statusEl.innerText=`Error: ${err.message||err}`;
  }
}

buildUI();
</script>
</body>
</html>
